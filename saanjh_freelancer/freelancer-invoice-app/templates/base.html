<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{ title or 'Saanjh Billing Dashboard' }}</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Custom Theme -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    :root {
      --saanjh-purple:#7c3aed;
      --saanjh-teal:#14b8a6;
      --sidebar-bg:#1e1b4b;
    }
    body {
      font-family:'Poppins',sans-serif;
      background:#f3f4f6;
      overflow-x:hidden;
      min-height:100vh;
      display:flex;
    }
    /* Sidebar */
    .sidebar {
      width:230px;
      background:var(--sidebar-bg);
      color:white;
      flex-shrink:0;
      display:flex;
      flex-direction:column;
      height:100vh;
      position:fixed;
    }
    .sidebar-header {
      padding:1.2rem 1rem;
      font-size:1.3rem;
      font-weight:600;
      text-align:center;
      background:linear-gradient(90deg,var(--saanjh-purple),var(--saanjh-teal));
    }
    .sidebar-header img {height:35px;margin-right:.5rem;}
    .sidebar a {
      color:#cbd5e1;text-decoration:none;display:block;
      padding:.75rem 1rem;transition:.3s;
    }
    .sidebar a:hover,.sidebar a.active {
      background:rgba(255,255,255,0.1);color:white;
    }
    .sidebar a .fa-solid {width:20px;text-align:center;}
    /* Content */
    .content {
      margin-left:230px;padding:2rem;width:calc(100% - 230px);
    }
    footer {
      background:#fff;border-top:1px solid #e5e7eb;font-size:.9rem;
      color:#6b7280;text-align:center;padding:.75rem;
      position:fixed;bottom:0;left:230px;width:calc(100% - 230px);
    }
    /* Notification Badge */
    .alert-badge {
      background:#ef4444;
      color:white;
      border-radius:50%;
      font-size:.7rem;
      font-weight:bold;
      padding:2px 6px;
      margin-left:6px;
    }
    @media(max-width:992px){
      .sidebar{position:relative;width:100%;height:auto;}
      .content{margin-left:0;width:100%;}
      footer{left:0;width:100%;position:relative;}
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="sidebar-header d-flex align-items-center justify-content-center">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
      <span>Saanjh</span>
    </div>
    <a href="{{ url_for('index') }}" class="{% if request.endpoint=='index' %}active{% endif %}">
      <i class="fa-solid fa-chart-pie me-2"></i> Dashboard
    </a>
    <a href="{{ url_for('clients') }}" class="{% if request.endpoint=='clients' %}active{% endif %}">
      <i class="fa-solid fa-users me-2"></i> Clients
    </a>
    <a href="{{ url_for('items') }}" class="{% if request.endpoint=='items' %}active{% endif %}">
      <i class="fa-solid fa-box-open me-2"></i> Items
    </a>
    <a href="{{ url_for('invoices') }}" class="{% if request.endpoint=='invoices' %}active{% endif %}">
      <i class="fa-solid fa-file-invoice me-2"></i> Invoices
    </a>

 

    <!-- âš™ï¸ Alerts / Notifications -->
    <a href="{{ url_for('admin_alerts') }}" class="{% if request.endpoint=='view_alerts' %}active{% endif %}">
      <i class="fa-solid fa-bell me-2"></i> View Alerts
      <span id="alertCount" class="alert-badge" style="display:none;">0</span>
    </a>

    <div class="mt-auto text-center py-3 small text-muted" style="font-size:.8rem;border-top:1px solid rgba(255,255,255,0.1);">
      <i class="fa-solid fa-code"></i> Saanjh Billing Â© {{ date.year if date else '2025' }}
    </div>
  </nav>

  <!-- Page Content -->
  <main class="content">
    {% block content %}{% endblock %}
  </main>

  <footer>
    <img src="{{ url_for('static', filename='logo.png') }}" height="20" class="me-1">
    {{ config['BUSINESS_NAME'] }} â€¢ {{ config['BUSINESS_EMAIL'] }}
  </footer>

  <!-- ðŸ”” Dynamic Notification Script -->
  <script>
  async function updateAlertBadge() {
      try {
          const res = await fetch('/api/alerts');
          if (!res.ok) return;
          const data = await res.json();
          const badge = document.getElementById('alertCount');

          if (data.length > 0) {
              badge.textContent = data.length;
              badge.style.display = 'inline-block';
          } else {
              badge.style.display = 'none';
          }
      } catch (err) {
          console.error('Error fetching alert count:', err);
      }
  }

  // Update badge every 30 seconds
  updateAlertBadge();
  setInterval(updateAlertBadge, 30000);
  </script>
</body>
</html>
